---
title: "é›¶æˆæœ¬æ­å»º AI QQ æœºå™¨äºº"
date: "2025-03-30T17:24:38+08:00"
tags: ["AI"]
categories: ["æ•™ç¨‹"]
draft: false
noindex: false
enableKaTeX: false
cover:
    image: "/img/fa9066a40e.md/cover.png"
    alt: "NapCat ç«™åœ¨å°æœ¨å±‹å¤–"
    hidden: false
---

ğŸŒ©ï¸ **å¤ªé•¿ä¸è¯»**ï¼šç”¨ Cloudflare Workers æ­å»ºä»£ç†ç™½å«– Geminiï¼Œç„¶åç”¨ AstrBot å’Œ NapCat æ¥å…¥ QQï¼Œå®ç°é›¶ï¼ˆä½ï¼‰æˆæœ¬çš„ AI QQ æœºå™¨äººã€‚

## ğŸ›ï¸ é¦–å…ˆè¦æœ‰ Gemini

Google æ˜¯ä¸ºæ•°ä¸å¤šçš„å¼€æ”¾å…è´¹å¤§è¯­è¨€æ¨¡å‹ API çš„æä¾›å•†ï¼Œä½†æ˜¯å¾ˆå¯æƒœï¼Œä¸å…¶ä»– Google æœåŠ¡ä¸€æ ·ï¼Œåœ¨å›½å†…æ˜¯æ— æ³•ç›´æ¥è®¿é—®çš„ã€‚è€ƒè™‘åˆ°ä½æˆæœ¬è¿™ä¸ªè¦æ±‚ï¼Œæˆ‘ä»¬ä½¿ç”¨ Cloudflare Workers æ­å»ºä¸€ä¸ªä»£ç†ï¼Œå®ç°å›½å†…è®¿é—®ã€‚

> å½“ç„¶å¦‚æœæ‚¨æœ‰å¢ƒå¤–æœåŠ¡å™¨ï¼Œé‚£æ›´å¥½ï¼Œç›´æ¥åœ¨ NGiNX é‡Œç”¨å¸¸è§„æ–¹æ³•æ·»åŠ åå‘ä»£ç†ã€‚æ‚¨éƒ½æœ‰æœåŠ¡å™¨äº†ï¼Œå°±ä¸éœ€è¦è¯å…ƒæ•™æ‚¨äº†å§ ğŸ˜

ç›®å‰ Gemini å¯¹ `gemini-2.0-flash` æä¾›äº†æ¯å¤© 1500 æ¬¡å…è´¹è¯·æ±‚ï¼Œè€Œ Cloudflare Workers åˆ™æœ‰æ¯å¤© 1000 ä¸‡æ¬¡å…è´¹è¯·æ±‚ï¼Œå¯¹äºä¸ªäººç”¨æˆ·ï¼Œå¦‚æœæ‚¨ä¸æŠŠæœºå™¨äººæ‹‰è¿‘å¥½å‡ ä¸ªå¤§ç¾¤ï¼Œè‚¯å®šæ˜¯ç»°ç»°æœ‰ä½™çš„ã€‚

é¦–å…ˆï¼Œæ‚¨è¦æœ‰ä¸ª Google è´¦å·ï¼Œè¿˜æœ‰ Cloudflare è´¦å·ï¼Œéƒ½ä¸éœ€è¦ç»‘å®šä¿¡ç”¨å¡â€”â€”ç›¸ä¿¡æ‚¨å¯ä»¥è‡ªå·±æå®šã€‚å¦å¤–è¿˜å¾—æœ‰ä¸ªåŸŸåï¼Œåœ¨ [NameSilo](https://www.namesilo.com) ä¸Šå¯ä»¥ä¹°ä¸ª .topï¼Œåå‡ å—ä¸€å¹´ï¼Œè¿˜èƒ½ç”¨æ”¯ä»˜å®ã€‚

ç„¶åï¼Œå» [Google AI Studio](https://aistudio.google.com/)ï¼Œåˆ›å»ºä¸€ä¸ª tokenï¼Œå¤åˆ¶å¤‡ç”¨ã€‚

![åœ¨ Google AI Studio ä¸­åˆ›å»ºä¸€ä¸ª token](/img/fa9066a40e.md/1.png)

![åˆ›å»ºç»“æŸï¼Œå¤åˆ¶å¤‡ç”¨](/img/fa9066a40e.md/2.png)

Gemini è¿™è¾¹å°±ç»“æŸäº†ï¼Œæ¥ä¸‹æ¥å» [Cloudflare](https://dash.cloudflare.com) åˆ›å»ºä¸€ä¸ª Workerã€‚

![åˆ›å»º Worker](/img/fa9066a40e.md/3.png)

ç„¶åï¼Œé€‰æ‹© Hello World é¡¹ç›®ï¼Œåˆ›å»ºä¸€ä¸ªç©ºé¡¹ç›®ï¼Œéšä¾¿èµ·ä¸ªåå­—ã€‚å»ºç«‹æˆåŠŸä¹‹åé€‰æ‹©â€œç¼–è¾‘ä»£ç â€ï¼Œç²˜è´´ä»¥ä¸‹çš„ JS ä»£ç ã€‚

```javascript
addEventListener('fetch', event => {
  event.respondWith(handleRequest(event.request))
})

async function handleRequest(request) {
  const url = new URL(request.url)
  let targetURL = new URL('https://generativelanguage.googleapis.com')

  targetURL.pathname = url.pathname
  targetURL.search = url.search

  let newRequest = new Request(targetURL, {
    method: request.method,
    headers: request.headers,
    body: request.body
  })

  let response = await fetch(newRequest)

  // æ·»åŠ è·¨åŸŸæ”¯æŒ
  let corsHeaders = {
    'Access-Control-Allow-Origin': '*',
    'Access-Control-Allow-Methods': 'GET,HEAD,POST,OPTIONS',
    'Access-Control-Allow-Headers': request.headers.get('Access-Control-Request-Headers'),
  }

  // å¦‚æœæ˜¯é¢„æ£€è¯·æ±‚ï¼Œç›´æ¥è¿”å›è·¨åŸŸå¤´
  if (request.method === 'OPTIONS') {
    return new Response(null, { headers: corsHeaders })
  }

  // å¤åˆ¶å“åº”ä»¥æ·»åŠ æ–°çš„å¤´
  let responseHeaders = new Headers(response.headers)
  for (let [key, value] of Object.entries(corsHeaders)) {
    responseHeaders.set(key, value)
  }

  return new Response(response.body, {
    status: response.status,
    statusText: response.statusText,
    headers: responseHeaders
  })
}
```

è¿™å°±æ˜¯ä¸€æ®µç®€å•çš„ä»£ç†ä»£ç ï¼Œè¯å…ƒæ˜¯ä»æŸä¸ªå¼€æºé¡¹ç›®é‡Œæ‘˜å–çš„ï¼Œä½†æ˜¯æƒ³ä¸èµ·æ¥æ˜¯å“ªä¸ªäº†ã€‚å¦‚æœæ‚¨çŸ¥é“æˆ–è€…æ‰¾åˆ°äº†ï¼Œè¿˜éº»çƒ¦è¯„è®ºå‘Šè¯‰è¯å…ƒï¼Œä»¥ä¾¿æ·»åŠ æ¥æºã€‚

ç„¶åï¼Œåœ¨è®¾ç½®ä¸­æ·»åŠ è‡ªå·±çš„åŸŸåã€‚`*.workers.dev` åœ¨å›½å†…æ˜¯è¢«å±è”½çš„ï¼Œæ‰€ä»¥éœ€è¦æ·»åŠ è‡ªå·±çš„åŸŸåã€‚

![æ·»åŠ è‡ªå·±çš„åŸŸå](/img/fa9066a40e.md/5.png)

å¦‚æœæ‚¨çš„åŸŸåå°±æ‰˜ç®¡åœ¨ Cloudflare ä¸Šï¼Œè¾“å…¥æ–°åŸŸåä¹‹åä¼šè‡ªåŠ¨æ·»åŠ  DNS è®°å½•ï¼›å¦‚æœä¸æ˜¯ï¼Œéœ€è¦æ‚¨è‡ªå·±æ·»åŠ ä¸€ä¸ªï¼Œå¹¶ä¸”å¯èƒ½æ— æ³•å¯ç”¨ SSLã€‚

æ­å»ºå®Œæˆä¹‹åï¼Œæˆ‘ä»¬ç”¨ curl æµ‹è¯•ä¸€ä¸‹ï¼š

```bash
curl "https://[YOUR_CUSTOM_DOMAIN]/v1beta/models/gemini-2.0-flash:generateContent?key=[GEMINI_API_KEY]" \
-H 'Content-Type: application/json' \
-X POST \
-d '{
  "contents": [{
    "parts":[{"text": "Explain how AI works"}]
    }]
   }'
```

å¦‚æœè¿”å›äº†ä¸€ä¸²åŒ…å«å›ç­”çš„ JSONï¼Œé‚£å°±è¯æ˜æ­å»ºæ˜¯æˆåŠŸçš„ã€‚æ­å–œ ğŸ‰

## ğŸ± NapCat

[NapCat](https://napcat.wiki) æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¥½ç”¨çš„ QQ to API å¹³å°ã€‚å®ƒé€šè¿‡ Electron æ³¨å…¥ï¼Œå®ç°æ™®é€šè´¦æˆ·çš„æ— å¤´æ“ä½œï¼Œä»è€Œç”¨ OneAPI çš„å½¢å¼æä¾›ç»Ÿä¸€çš„æ¥å£ã€‚

å®‰è£…çœŸçš„æ˜¯éå¸¸ç®€å•äº†ï¼ŒNapCat æä¾›äº†ä¸€é”®å®‰è£…çš„è„šæœ¬ï¼Œç”šè‡³èƒ½è‡ªåŠ¨ä½¿ç”¨ GitHub é•œåƒã€‚

> ğŸš¨ è­¦å‘Šï¼š**ä¸è¦**åœ¨å¢ƒå¤–æœåŠ¡å™¨ä¸Šæ­å»º NapCatï¼Œå¦åˆ™é€€ç™»ã€å°å·ç­‰é—®é¢˜åæœè‡ªè´Ÿã€‚å…¶å®è¯å…ƒéƒ½ä¸å»ºè®®åœ¨å…¬ç½‘æœåŠ¡å™¨ä¸Šæ­å»ºï¼Œæ‹¿ä¸€éƒ¨æ ‘è“æ´¾æˆ–è€…æ—§æ‰‹æœºæœ€å®‰å…¨ã€‚

```bash
curl -o napcat.sh https://nclatest.znin.net/NapNeko/NapCat-Installer/main/script/install.sh && sudo bash napcat.sh
```

å®‰è£…è¿‡ç¨‹ä¸­æ‰€æœ‰æåŠçš„é€‰é¡¹å…¨éƒ¨éƒ½é€‰æ‹© `y`ï¼Œç„¶åé™å€™å®‰è£…å®Œæˆã€‚æœ€åï¼Œè„šæœ¬ä¼šç»™å‡ºåˆå§‹å¯†ç ï¼Œè®°å¾—ä¿å­˜ã€‚

åœ¨æ‚¨çš„æµè§ˆå™¨ä¸Šæ‰“å¼€ `http://[YOUR_SERVER_IP]:6099/webui/`ï¼ˆè®°å¾—å¼€é˜²ç«å¢™ï¼‰ï¼Œè¾“å…¥åˆšåˆšè®°ä¸‹çš„å¯†ç ï¼Œç„¶åç”¨æ‚¨çš„ QQ å°å·æ‰«ç ç™»å½•ã€‚

> QQ å¯èƒ½ä¼šè¦æ±‚æ–°åˆ›å»ºçš„è´¦å·å®åè®¤è¯ã€‚è¿™æ˜¯ä¸€ä¸ªçœ‹äººå“çš„æ´»å„¿ï¼Œå¦‚æœæ‚¨å®åœ¨ä¸æƒ³å®åï¼Œå°±åœ¨è¿™å„¿æ”¾å¼ƒå§â€¦â€¦è¯å…ƒä¹Ÿæ˜¯è¢«è¿«éªŒè¯äº†ä¸€ä¸‹ã€‚

ç™»å½•ä¹‹åï¼Œå¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š

![NapCat ä¸»ç•Œé¢](/img/fa9066a40e.md/6.png)

å—¯ï¼ŒèŠ±é‡Œèƒ¡å“¨ã€‚è®°å¾—å…³éŸ³é‡ï¼Œä¼šæœ‰ä¸€ä¸ªéŸ³ä¹æ’­æ”¾å™¨è‡ªåŠ¨å¼€å§‹æ’­æ”¾ ğŸ˜®â€ğŸ’¨

NapCat å®é™…ä¸Šå¯ä»¥çœ‹æˆæ˜¯ QQ çš„ APIã€‚æˆ‘ä»¬åœ¨â€œç½‘ç»œé…ç½®â€é‡Œæ·»åŠ ä¸€ä¸ª WebSocket å®¢æˆ·ç«¯ï¼Œä¾›å¾…ä¼šå„¿ AstrBot è¿æ¥ã€‚

![æ·»åŠ  WebSocket å®¢æˆ·ç«¯](/img/fa9066a40e.md/7.png)

è¿™é‡Œæ³¨æ„ï¼Œä¸€æ˜¯è¦æ·»åŠ  `/ws` åç¼€ï¼›äºŒæ˜¯ä¸è¦é€‰æ‹©å…¶ä»–ç«¯å£ï¼Œå› ä¸ºå¾…ä¼šå„¿ AstrBot æ˜¯ä½¿ç”¨ Podman è¿è¡Œçš„ï¼Œåªèƒ½ä½¿ç”¨æ˜ å°„çš„ç«¯å£èŒƒå›´ã€‚å¦‚æœæ‚¨é€‰æ‹©å…¶ä»–ç«¯å£ï¼Œè¯·ç¡®ä¿æ‚¨ç†è§£ã€‚

## ğŸ¤– AstrBot

ç”±äºä½¿ç”¨äº†å®¹å™¨åŒ–æŠ€æœ¯ï¼Œ[AstrBot](https://astrbot.app/) çš„å®‰è£…ä¹Ÿéå¸¸ç®€å•ã€‚

é¦–å…ˆï¼Œå®‰è£… Podmanã€‚è¿™ä¸»è¦æ˜¯å› ä¸º Podman åœ¨å¤§éƒ¨åˆ† Linux å‘è¡Œç‰ˆä¸­éƒ½æœ‰æ‰“åŒ…ï¼Œä¸éœ€è¦è´¹ç¥å®‰è£…ã€‚

```bash
sudo apt install podman podman-docker podman-compose # å¦‚æœä¸ä½¿ç”¨ podman-dockerï¼Œä»¥ä¸‹å‘½ä»¤éœ€è¦ä¿®æ”¹å¥—æ¥å­—åç§°
sudo systemctl enable --now podman.socket
```

ç„¶åæ‹‰å–é•œåƒï¼š

```bash
mkdir astrbot
cd astrbot
mkdir data
sudo podman run -itd -p 6180-6200:6180-6200 -p 11451:11451 -v $PWD/data:/AstrBot/data -v /var/run/docker.sock:/var/run/docker.sock -v /etc/localtime:/etc/localtime:ro -v /etc/timezone:/etc/timezone:ro --name astrbot soulter/astrbot:latest
```

å¦‚æœæ‚¨æ— æ³•æ­£å¸¸è®¿é—® Docker Hubï¼Œå¯ä»¥ç”¨[é•œåƒ](https://www.coderjia.cn/archives/dba3f94c-a021-468a-8ac6-e840f85867ea)ï¼Œä½¿ç”¨æ–¹æ³•æ‚¨å¯ä»¥åœ¨ç½‘ä¸Šæœç´¢ä¸€ä¸‹ã€‚

å®Œæˆä¹‹åï¼Œå¯ä»¥é€šè¿‡ `http://[YOUR_SERVER_IP]:6180` è®¿é—® AstrBot çš„ç®¡ç†ç•Œé¢ï¼Œåˆå§‹ç”¨æˆ·åå’Œå¯†ç éƒ½æ˜¯ `astrbot`ã€‚

![AstrBot ä¸»ç•Œé¢](/img/fa9066a40e.md/8.png)

ç„¶ååœ¨æ¶ˆæ¯å¹³å°è®¾ç½®ä¸­æ·»åŠ ä¸€æ¡ï¼š

![æ·»åŠ æ¶ˆæ¯å¹³å°](/img/fa9066a40e.md/9.png)

è¿™æ ·ï¼ŒNapCat ä¸ AstrBot çš„è¿æ¥å°±æå®šäº†ã€‚

## âš™ï¸ é…ç½® AstrBot

åœ¨ AstrBot çš„æœåŠ¡æä¾›å•†è®¾ç½®ä¸­ï¼Œæ·»åŠ ä¸€æ¡ï¼Œè¾“å…¥æˆ‘ä»¬åˆšåˆšè·å¾—çš„ä»£ç†åœ°å€å’Œ API å¯†é’¥ã€‚

![æ·»åŠ æœåŠ¡æä¾›å•†](/img/fa9066a40e.md/10.png)

AstrBot æœ‰ä¸°å¯Œçš„æ’ä»¶ã€è®¾ç½®ã€æƒé™ç­‰åŠŸèƒ½ï¼Œæ‚¨å¯ä»¥è‡ªè¡Œæ¢ç´¢ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚

## â¬†ï¸ æ›´æ–°

NapCat æœ‰å†…å»ºçš„æ›´æ–°å‘½ä»¤ï¼š

```bash
sudo napcat update
```

AstrBot åˆ™éœ€è¦é‡æ–°æ‹‰å–é•œåƒï¼Œä½†æ˜¯é…ç½®æ–‡ä»¶ä¿å­˜åœ¨å®¿ä¸»æœºï¼Œä¸ä¼šä¸¢å¤±ï¼š

```bash
sudo podman stop astrbot
sudo podman rm astrbot
sudo podman pull soulter/astrbot
# ç„¶åé‡å¤ä»¥ä¸Šå¯åŠ¨å‘½ä»¤å³å¯
```

## ğŸ¤” é‡å¤§æ›´æ–°

è¯å…ƒæœ€è¿‘çœ‹åˆ° NapCat æœ‰äº†å®˜æ–¹æ„å»ºçš„ Docker é•œåƒã€‚è¯å…ƒå¾ˆå–œæ¬¢æŠŠä»€ä¹ˆä¸œè¥¿éƒ½å®¹å™¨åŒ–ï¼Œæ‰€ä»¥å†™äº†ä»¥ä¸‹ Compose ä¾›æ‚¨å‚è€ƒï¼š

```yaml
services:
  napcat:
    environment:
      - "NAPCAT_UID=${NAPCAT_UID}"
      - "NAPCAT_GID=${NAPCAT_GID}"
      - "TZ=Asia/Shanghai"
    ports:
      - "3000:3000"
      - "3001:3001"
      - "6099:6099"
    volumes:
      - "./ntqq:/app/.config/QQ"
      - "./napcat:/app/napcat/config"
    container_name: napcat
    restart: always
    image: docker-0.unsee.tech/mlikiowa/napcat-docker:latest

  astrbot:
    environment:
      - "TZ=Asia/Shanghai"
    ports:
      - "6185:6185"
      - "6199:6199"
    volumes:
      - "./data:/AstrBot/data"
      - "/var/run/docker.sock:/var/run/docker.sock"
    container_name: astrbot
    restart: always
    image: docker-0.unsee.tech/soulter/astrbot:latest
```

## ğŸ”” ä¸‹è¯¾ï¼

å¿«æŠŠä½ çš„æœºå™¨äººæ‹‰è¿›ç¾¤é‡Œç‚«è€€ä¸€ä¸‹å§ã€‚æ³¨æ„ Gemini çš„é™åˆ¶è¾ƒä½ï¼Œå½“å¿ƒ NSFW å†…å®¹å’Œä¾®è¾±æ€§è¯­è¨€è¾“å‡ºã€‚å°å·äº†å¯åˆ«æ€ªè¯å…ƒã€‚
